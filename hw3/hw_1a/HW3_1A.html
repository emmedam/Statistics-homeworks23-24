<!DOCTYPE html>
<html>
<head>
    <title>Security Score Simulation</title>
    <style>
        #canvas-container {
            border: 1px solid #000;
            position: relative;
        }

        grafico {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <div id="controls">
        <label for="N">Number of Attacks (N):</label>
        <input type="number" id="N" value="100">
        <br>
        <label for="M">Number of Systems (M):</label>
        <input type="number" id="M" value="3">
        <br>
        <label for="p">Penetration Probability (p):</label>
        <input type="number" id="p" step="0.01" value="0.5">
        <br>
        <button onclick="startSimulation()">Start Simulation</button>
    </div>

    <div id="canvas-container" width= "600" height="400">
        <canvas id="grafico" width="400" height="200"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('grafico');
        const context = canvas.getContext('2d');
        const container = document.getElementById('canvas-container');
        const width = container.clientWidth;
        const height = container.clientHeight;
        canvas.width = width;
        canvas.height = height;
        const xOffset = 50; // Spazio a sinistra del canvas
        const yOffset = 50; // Spazio sopra il canvas
        const yScale = 50;
        const score_line = [];

        let N = document.getElementById('N').value; // Number of attacks
        let M = document.getElementById('M').value;
        let p = document.getElementById('p').value; // Probability of penetration (0 to 1)
         init_graph()

        function init_graph() {
            //const step = width / N;
            context.beginPath();
            context.moveTo(0, height / 2);
            context.lineTo(width, height / 2);
            // for (let i= 0; i < N; i++){
            //     context.moveTo(step * i, 0);
            //     context.lineTo(step * i, height);
            // }
            context.stroke();
        }

       function simulateSecurityScores() {
            const scores = [];
            
            for (let j = 0; j < M; j++) {
                const scoresForSystem = [];
                for (let i = 0; i < N; i++) {
                    const random = Math.random();
                    if (random < p) {
                        scoresForSystem.push(-1);
                    } else {
                        scoresForSystem.push(1);
                    }
                }
                scores.push(scoresForSystem);
            }
            return scores;
        }

        function drawChart() {

            const step = width / N;
            let x = 0;
            let y = height / 2;

            // context.clearRect(0, 0, width, height);
            context.beginPath();
            context.moveTo(0, y);
            context.strokeStyle = `rgb(0,
                ${Math.floor(Math.random() * 255)},
                ${Math.floor(Math.random() * 255)})`;

            for (let i = 0; i < score_line.length; i++) {
                x += step;
                y -= score_line[i] * 2;
                context.lineTo(x, y);
            }
            context.stroke();
        }

      
       

        function startSimulation() {
            N = parseInt(document.getElementById('N').value);
            p = parseFloat(document.getElementById('p').value);
            M = parseInt(document.getElementById('M').value);

            const interval = 100;
            let i = 0;

            // const systemTimers = [];
            const scores = simulateSecurityScores();
            console.log('scores: ', scores);
            context.reset();
            init_graph();
            // Avvia timer separato per ogni sistema
            for (let j = 0; j < M; j++) {
                score_line.length = 0;
                score_line.push(...scores[j]);
                drawChart();
            }
        }
  

        let isResizing = false;
        let resizeOffsetX, resizeOffsetY;

        container.addEventListener("mousedown", (event) => {
            const rect = canvas.getBoundingClientRect();
            resizeOffsetX = event.clientX - rect.right;
            resizeOffsetY = event.clientY - rect.bottom;
            isResizing = true;
        });

        window.addEventListener("mousemove", (event) => {
            if (isResizing) {
                canvas.style.width = event.clientX - canvas.getBoundingClientRect().left - resizeOffsetX + "px";
                canvas.style.height = event.clientY - canvas.getBoundingClientRect().top - resizeOffsetY + "px";
                container.style.width = event.clientX - canvas.getBoundingClientRect().left - resizeOffsetX + "px";
                container.style.height = event.clientY - canvas.getBoundingClientRect().top - resizeOffsetY + "px";
                // drawChart();
            }
        });

        window.addEventListener("mouseup", () => {
            isResizing = false;
            // drawChart();
        });

        window.addEventListener("resize", () => {
            // Adjust canvas size if the window is resized
            canvas.style.width = container.clientWidth + "px";
            canvas.style.height = container.clientHeight + "px";
            container.style.width = container.clientWidth + "px";
            container.style.height = container.clientHeight + "px";
            // drawChart();
        });

        // drawChart();
    </script>

</body>
</html>