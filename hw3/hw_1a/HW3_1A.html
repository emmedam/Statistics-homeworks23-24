<!DOCTYPE html>
<html>

    <head>
        <title>Security Score Simulation</title>
        <style>
            #canvas-container {
                border: 1px solid #000;
                position: relative;
            }

            grafico {
                position: absolute;
                top: 0;
                left: 0;
            }
        </style>
    </head>

    <body>
        <div id="controls">
            <label for="N">Number of Attacks (N):</label>
            <input type="number" id="N" value="100">
            <br>
            <label for="M">Number of Systems (M):</label>
            <input type="number" id="M" value="3">
            <br>
            <label for="p">Penetration Probability (p):</label>
            <input type="number" id="p" step="0.01" value="0.5">
            <br>
            <button onclick="startSimulation()">Start Simulation</button>
        </div>

        <div id="canvas-container" width= "600" height="400">
            <canvas id="grafico" width="400" height="200"></canvas>
        </div>

        <script>
            const canvas = document.getElementById('grafico');
            const context = canvas.getContext('2d');
            const container = document.getElementById('canvas-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            canvas.width = width;
            canvas.height = height;
            const xOffset = 50; // Spazio a sinistra del canvas
            const yOffset = 50; // Spazio sopra il canvas
            const yScale = 50;

            let N = document.getElementById('N').value; // Number of attacks
            let M = document.getElementById('M').value;
            let p = document.getElementById('p').value; // Probability of penetration (0 to 1)


            function startSimulation() {
                N = parseInt(document.getElementById('N').value);
                p = parseFloat(document.getElementById('p').value);
                M = parseInt(document.getElementById('M').value);

                const interval = 100;
                let i = 0;

                const trajectories = [];
                const scores = simulateSecurityScores();
                scores.forEach(score => {
                    score.forEach(m => {
                        
                    })
                });
                const systemTimer = setInterval(() => {
                    if (j < scores[systemIndex].length) {
                        trajectories.push(scores[systemIndex][j]);
                        drawChart(); // Passa i punteggi e l'indice del sistema a drawChart
                        j++;
                    } else {
                        clearInterval(systemTimer);
                    }
                }, interval);
            }



            function simulateSecurityScores() {
                const scores = [];
                
                for (let j = 0; j < M; j++) {
                    const scoresForSystem = [];
                    for (let i = 0; i < N; i++) {
                        const random = Math.random();
                        if (random < p) {
                            scoresForSystem.push(-1);
                        } else {
                            scoresForSystem.push(1);
                        }
                    }
                    scores.push(scoresForSystem);
                }
                console.log(scores);
                return scores;
            }

            function drawChart() {
                const step = width / N;
                let x = 0;
                let y = height / 2;

                context.clearRect(0, 0, width, height);
                context.beginPath();
                context.moveTo(0, y);
                for (let i = 0; i < trajectories.length; i++) {
                    x += step;
                    y -= trajectories[i];
                    context.lineTo(x, y);
                }

                context.stroke();

                // Draw X and Y axes
                context.beginPath();
                context.moveTo(0, height / 2);
                context.lineTo(width, height / 2);
                context.moveTo(0, 0);
                context.lineTo(0, height);
                context.stroke();
            }
        
            let isResizing = false;
            let resizeOffsetX, resizeOffsetY;

            container.addEventListener("mousedown", (event) => {
                const rect = canvas.getBoundingClientRect();
                resizeOffsetX = event.clientX - rect.right;
                resizeOffsetY = event.clientY - rect.bottom;
                isResizing = true;
            });

            window.addEventListener("mousemove", (event) => {
                if (isResizing) {
                    canvas.style.width = event.clientX - canvas.getBoundingClientRect().left - resizeOffsetX + "px";
                    canvas.style.height = event.clientY - canvas.getBoundingClientRect().top - resizeOffsetY + "px";
                    container.style.width = event.clientX - canvas.getBoundingClientRect().left - resizeOffsetX + "px";
                    container.style.height = event.clientY - canvas.getBoundingClientRect().top - resizeOffsetY + "px";
                    drawChart();
                }
            });

            window.addEventListener("mouseup", () => {
                isResizing = false;
                drawChart();
            });

            window.addEventListener("resize", () => {
                // Adjust canvas size if the window is resized
                canvas.style.width = container.clientWidth + "px";
                canvas.style.height = container.clientHeight + "px";
                container.style.width = container.clientWidth + "px";
                container.style.height = container.clientHeight + "px";
                drawChart();
            });

            drawChart();
        </script>

    </body>
</html>